                                        出租车计价器概要设计说明书
                                            出租车计价器设计。
一、 设计任务书
    1、设计任务：出租车计价器。
    2、设计要求：
        （1）设计一个出租车自动计价器，具有行车里程计费、等候时间计费、起价、实时时钟、速度以及打印发票的功能，以上其功能均显示在LCD显示屏上。
        （2）行车里程的计费：3公里以内按基本费用收取，3公里以外：费用=里程*里程单价+等候费用+基本费 
二、 设计目的及意义
    随着电子技术的发展,出租车计价器技术也在不断进步和提高,国内出租车计价器已经经历了四个阶段的发展,从传统的全部由机械元器件组成的机械式,到半电子式即用电子线路代替部分机械元器件的出租车计价器,再从集成电路式到目前的TIM定时器系统设计的出租车计价器。 
    本设计是以TIM定时器为核心,以STM32控制器为外设的出租车计价器的系统设计，该系统满足集计程、计时、计费、查看、统计等多种计量功能为一体的出租车计价器的实用要求。
三、 设计所用器材：stm32实验板。
四、 计费及显示要求
    1.里程:  用四位数字显示，显示方式为"XXX.X"，单位为㎞，精确到0.1㎞。
    2.等候时间:  用四位数字显示分钟和秒，显示方式为"XX：XX"，等候的定义是：当汽车处于PAUSE或者速度低于12km/h状态时，出租车处于等候状态，必须对等候时间进行统计计算。
    3.等候单价:  将等候时间转化成里程，每等候5分钟按一公里收费。
    4.费用的计算：3公里以内按基本费用收取，3公里以外：费用=里程*里程单价+等候费用+基本费。
    5.费用的显示:  用四位数字显示，显示方式为"XXX.0"，单价为元。
    6.时钟及显示:  当出租车正常运行时，应能显示当前的时间，在汽车熄火时，时钟也必须正常运行。
    7.计费提示：  当出租车无乘客时，计价器显示欢迎乘坐请系好安全带的提示语，当有乘客时，司机将按键按下开始计时计费同时指示灯点亮。
五、各功能模块的设计
    根据系统的设计要求，将整个系统分为如下几个模块，它们分别是：等待判别模块，里程计算模块，里程计费模块，等待计时模块，等待计费模块，打印发票模块，LCD显示模块，按键模块，串口调试模块等。
    1.等待判别模块：当速度低于15km/h或者遇红灯停车时，将出租车视为等待状态，LCD显示等待时间开始计数。
    2.里程计算模块：根据速度与时间来计算里程，将里程标志信号和里程计费标志信号同时显示在LCD上。
    3.里程计费模块：在计费信号，等待信号，里程信号和时段信号等信号的控制下，计算行驶里程。当里程计数器显示数大于3km时，单价按2.4元/㎞计算且计算公式为：费用 = 里程 * 里程单价 + 等候费用 + 基本费。当里程计数器显示数小于3km时，按起价费用计算且为3元。
    4.等待计时模块：在等待信号的控制下，进行等待时间的计算，并予以显示。
    5.等待计费模块：在等待信号控制下，进行等待费用的计费操作。
    6.输出数据选择模块：通过LCD显示屏将数据显示出来。
    7.LCD显示模块：当无乘客时显示欢迎乘坐请系好安全带的问候语，但有乘客时显示里程、时间、金额等相关内容。
    8.按键模块：通过stm32控制系统板上的两个按键来控制切换界面和模拟调整速度。　
    9.串口模块：通过USART将结帐的数据发送到模拟串口打印机（超级终端）。
六、 测试数据及测试结果分析
    测试中我们主要按照不同的单价和速度来计算总价和里程，测试标准为：3公里以内以起步价3元计，超过3公里按2.4元/km的单价计算。
七、项目结果：测试结果与理论值相符，达到设计要求。
八、收获与体会
    通过本次设计，我们学习了mdk软件。系统的掌握了我们所学的知识，并且得以应用。在设计过程中认真学习了相关的知识，极大地拓展了我的知识面,我感到收获不小。从开始熟悉这些知识到对整体设计的了解，再从概要设计、详细设计到开始使用软件，以及最后的调试，整个过程感觉很充实。虽然遇到了不少困难，但当我们通过查看资料，向指导老师请教以及与同学互讨论，而设计出解决方案并成功实现时，那种成就感和满足感足以忘却所有的辛苦。但是由于课程设计时间较短和自己知识的不足，所以该设计还有许多不尽如人意的地方，可能在实际应用中有些功能不到位。
